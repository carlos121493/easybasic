<!DOCTYPE html>
<html>

<head>
    <link href='assets/fonts/googlefont.css' rel='stylesheet' type='text/css'>
    <link href="assets/css/loader.css" rel="stylesheet" type="text/css" />
    <script src="assets/js/jquery.min.js"></script>
</head>

<body style="font-size: 14px; line-height: 19px;overflow:hidden; background:white; width:100%;height:100vh; font-family: sans-serif;">
    <style type="text/css">
        .monaco-editor .token.LineNums {
            color: #5576af;
        }
        
        .monaco-editor .token.comment {
            font-style: italic!important;
        }
        
        .monaco-editor .token.functions {
            color: #5d40d4;
        }
        
        .monaco-editor .token.operators {
            color: #bc4d2f;
        }
        
        .monaco-editor .token.TypeKeywords {
            color: #2d78c8;
        }
        
        .myLineDecoration {
            background: lightgreen;
            width: 4px !important;
        }
    </style>
    <div class="checkbox">
        <label>
            <input type="checkbox" style="margin: 10px;" id="editorCheck"> Inline Diff Editor
        </label>
    </div>
    <div id="container" style="width:100%;height:100vh;"></div>
    <script src="../node_modules/monaco-editor/min/vs/loader.js"></script>

    <script>
        var n =0;
        function getGrammer(name){
            var extension = name.split(".")[name.split(".").length-1];
            var grammer ="";
            if (extension.toLowerCase() == "bas")
                grammer = "gb";
            else if (extension.toLowerCase() == "json")
                grammer = "json";
            else if (extension.toLowerCase() == "css")
                grammer = "css";
            else if (extension.toLowerCase() == "js")
                grammer = "javascript";
            else if (extension.toLowerCase() == "html")
                grammer = "html";
            return grammer;
        }
        
        const fs = window.top.require('fs');
        var modifiedPath =window.top.modifiedPath.innerText;
        var originalPath =window.top.originalPath.innerText;
        fs.stat(modifiedPath, function(err, stats){
            if (err){
                return alert(err);
            }
        })
        var modifiedData = fs.readFileSync(modifiedPath , "utf8");
        fs.stat(originalPath, function(err, stats){
            if (err){
                return alert(err);
            }
        })
        var originalData = fs.readFileSync(originalPath , "utf8");

        function getOriginalGrammer(){
            var name = originalPath.toString().split("\\")[originalPath.toString().split("\\").length-1];
            return getGrammer(name);
        }
        function getModifiedGrammer(){
            var name = modifiedPath.toString().split("\\")[modifiedPath.toString().split("\\").length-1];
            return getGrammer(name);
        }

        require.config({ paths: { 'vs': '../node_modules/monaco-editor/min/vs' }});
        
        require(['vs/editor/editor.main'], function() {
            var originalModel = monaco.editor.createModel(originalData, getOriginalGrammer());
            var modifiedModel = monaco.editor.createModel(modifiedData, getModifiedGrammer());

            var diffEditor = monaco.editor.createDiffEditor(document.getElementById("container"), {
                readOnly:true,
                automaticLayout:true,
                contextmenu:false
            });
            diffEditor.setModel({
                original: originalModel,
                modified: modifiedModel
            });
            $('#editorCheck').change(function () {
                diffEditor.updateOptions({
                    renderSideBySide: !$(this).is(':checked')
                });
            });
            diffEditor.onDidUpdateDiff(function(e){
                if(n==0){
                    window.top.document.getElementById('status').innerHTML = "Loaded Diff Editor";
                    n++;
                }
            })
        });
    </script>
</body>

</html>